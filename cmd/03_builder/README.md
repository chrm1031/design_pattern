# Builder

複雑なオブジェクトを段階的に構築できる生成に関するデザインパターン
同じ構築コードを使用して異なる型と表現のオブジェクトを生成することが可能

![builder](https://refactoring.guru/images/patterns/content/builder/builder-ja.png)

## 構造
![UML](https://refactoring.guru/images/patterns/diagrams/builder/structure-indexed.png)

1. ビルダー （Builder） インターフェースは、 すべての型のビルダーに共通するプロダクト構築の様々なステップを宣言します。

2. 具象ビルダー （Concrete Builder） は、 様々な構築ステップの実装を行います。 具象ビルダーは、 共通インターフェース外のプロダクトの産出も可能です。

3. プロダクト （Product） は、 結果のオブジェクトです。 異なるビルダーによって構築された製品は、 同じクラス階層やインターフェースに属する必要はありません。

4. ディレクター （Director） クラスは、 構築ステップを呼び出す順序を定義し、 プロダクトの特定の設定を作成して再利用できます。

5. クライアント （Client） は、 ビルダー・オブジェクトの一つをディレクターに関連付ける必要があります。 通常、 ディレクターのコンストラクターのパラメータを介して 1 回だけ実行されます。 その後、 ディレクターはそのビルダー・オブジェクトをその後のすべての構築に使用します。 しかし、 クライアントがビルダー・オブジェクトをディレクターの産出メソッドに渡すタイミングに関しては、 別のやり方もあります。 この場合、 ディレクターが何かの産出をするごとに、 別のビルダーを使用できます。

## 実装方法
1. 利用できるすべてのプロダクトの表現 （種類） を構築するために必要な共通の構築ステップが、 明確に定義可能であることを確認してください。 そうでなければ、 パターンの実装に進むことはできません。

2. これらのステップを、 共通のビルダー・インターフェースで宣言します。

3. プロダクトの表現ごとに具象ビルダー・クラスを作成し、 その構築ステップを実装します。構築の結果を取得するためのメソッドの実装をお忘れなく。 このメソッドがビルダーのインターフェース内で宣言できない理由は、 ビルダーによっては共通のインターフェースを持たないプロダクトを構築する可能性があるためです。 したがって、 メソッドの戻り値の型がわかりません。 ただし、 単一の階層にあるプロダクトを扱う場合は、 結果取得用メソッドを安全に共通インターフェースに追加することが可能です。

4. ディレクター・クラスの作成を検討してみてください。 同じビルダーのオブジェクトを使用して、 プロダクトを構築するための様々な方法を一箇所にまとめることが可能かもしれません。

5. クライアント・コードで、 ビルダーとディレクターの両方のオブジェクトを作成します。 構築開始前に、 クライアントはビルダーのオブジェクトをディレクターに渡す必要があります。 通常、 クライアントはディレクターのコンストラクターのパラメータを介して一度だけこれを行います。 ディレクターは、 そのビルダー・オブジェクトをその後のすべての構築で使用します。 それに代わるやり方として、 ディレクターの特定プロダクト用構築メソッドにビルダーを直接渡すということもできます。

6. すべてのプロダクトが同じインターフェースに従っている場合は、 構築結果をディレクターから直接取得できます。 そうでない場合は、 クライアントはビルダーから結果を取得する必要します。

## 他のパターンとの関係
- 多くの設計は、 まず比較的単純でサブクラスによりカスタマイズ可能な、 Factory Method から始まり、 次第に、 もっと柔軟だが複雑な Abstract Factory や Prototype や Builder へと発展していきます。

- Builder は、 複雑なオブジェクトを段階的に構築することに重点を置いています。 Abstract Factory は、 関連するオブジェクトの集団を作成することに特化しています。 Abstract Factory がすぐにプロダクトを返すのに対して、 Builder ではプロダクトの取得前に、 いくつかの追加の構築のステップを踏まなければなりません。

- Builder は、 複雑な Composite ツリー作成に使用できます。 構築ステップを再帰的に行なうように プログラムします。

- Builder と Bridge を組み合わせることができます： ディレクター・クラスは抽象化層の役割を果たし、 ビルダーは実装です。

- Abstract Factories、 Builders、 Prototypes はどれも Singletons で実装可能です。

## 引用元

> https://refactoring.guru/ja/design-patterns/builder
> https://refactoring.guru/images/patterns/content/builder/builder-ja.png
> https://refactoring.guru/images/patterns/diagrams/builder/structure-indexed.png