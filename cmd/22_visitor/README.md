# Visitor
Visitor （ビジター、 訪問者） は、アルゴリズムをその動作対象となるオブジェクトから切り離す

![visitor](https://refactoring.guru/images/patterns/content/visitor/visitor.png)

## 構造
![UML](https://refactoring.guru/images/patterns/diagrams/visitor/structure-ja-indexed.png)

1. ビジター （Visitor） インターフェースは、 オブジェクト構造の具象要素を引数として取る一連の訪問メソッドを宣言します。 多重定義をサポートする言語でプログラムが書かれている場合は、 これらのメソッドの名前は同じでかまいません。 しかしパラメータの種類は違わなければなりません。

2. それぞれの具象ビジター （Concrete Visitor） は、 異なる具体的要素クラスに合わせて調整され、 同じ動作をするいくつかのバージョンを実装しています。

3. 要素 （Element） インターフェースは、 ビジターを受け入れる （accept） ためのメソッドを宣言します。 このメソッドは、 ビジター・インターフェースの型で宣言されたパラメータ一つを取る必要があります。

4. 各具象要素 （Concrete Element） は、 ビジターを受け入れるためのメソッドを実装する必要があります。 このメソッドの目的は、 現在の要素クラスに対応する適切なビジター・メソッドを呼び出すようにすることです。 仮に基底要素クラスがこのメソッドを実装していても、 すべてのサブクラスは、 このメソッドを上書きし、 ビジター・オブジェクト上の適切なメソッドを呼び出す必要があります。

5. クライアント （Client） は通常は、 コレクションまたはその他の複雑なオブジェクト （たとえば、 コンポジットツリー） を表します。 通常、 クライアントは具象要素クラスをすべて認識していません。 そのコレクションのオブジェクトと抽象的なインターフェースを通してやりとりするからです。

## 実装方法
1. プログラム中の各具象要素クラスごとに、 ​ 「訪問」 メソッドの組からなるビジター・インターフェースを宣言します。

2. 要素インターフェースを宣言します。 もし既存の要素クラスの階層があるのであれば、 抽象 「受け入れ」 ​ （accept） メソッドを階層の基底クラスに追加します。 このメソッドは、 ビジター・オブジェクトを引数として取ります。

3. すべての具象要素クラスで、 受け入れメソッド(複数あるかもしれません） を実装します。 これらのメソッドは、 単に呼び出しを、 現要素のクラスと一致する、 渡された訪問オブジェクトの訪問メソッドの呼び出しに換えます。

4. 要素クラスは、 ビジター・インターフェースを通してのみ、 ビジターと関わるべきです。 ビジターは、 逆に、 訪問メソッドのパラメーター型として参照されるすべての具象要素クラスを知っておく必要があります。

5. 要素の階層の中で実装できない振る舞いの一つごとに、 新しい具象ビジター・クラスを作成し、 訪問メソッドを全部実装します。ビジターが要素クラスの非公開メンバーにアクセスする必要がある状況に遭遇するかもしれません。 この場合、 要素のカプセル化の目標に反してこれらのフィールドやメソッドを公開するか、 ビジター・クラスを要素クラス中にネストすることができます。 後者は、 幸運にも使用しているプログラミング言語がクラスのネストをサポートする場合にのみ可能です。

6. クライアントはビジター・オブジェクトを複数作成し、 それらを要素の 「受け入れ」 メソッドに渡します。

## 他のパターンとの関係
- Visitor を Command パターンのより強力なものとして扱うことができます。 そのオブジェクトは、 異なるクラスの様々なオブジェクトに対して操作を実行できます。

- Visitor を使用して、 Composite ツリー全体に対して一つの操作を実行できます。

- 複雑なデータ構造を探索し、 その要素に対してある操作を実行するために、 Visitor を Iterator と一緒に使用することができます。 要素のクラスが全部異なっていてもかまいません。

## 引用元

> https://refactoring.guru/ja/design-patterns/visitor
> https://refactoring.guru/images/patterns/content/visitor/visitor.png
> https://refactoring.guru/images/patterns/diagrams/visitor/structure-ja-indexed.png